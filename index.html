<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deepa Store - Mobile Flash Sale</title>
  <style>
    :root{
      --accent:#ff6b6b;
      --bg:#0f1724;
      --card:#0b1220;
      --glass:rgba(255,255,255,0.04);
      --text-color:#e6eef8; /* Define a text color variable */
      --secondary-text-color:rgba(230, 239, 248, 0.8); /* Define a secondary text color variable */
    }
    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
    }
    html,body{
      height:100%;
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background:linear-gradient(180deg,#071028 0%, #071835 100%);
      color:var(--text-color);
      -webkit-font-smoothing:antialiased;
      line-height:1.6; /* Improve readability */
    }

    /* General Layout */
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh; /* Ensure body takes full viewport height */
    }

    header{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      flex-wrap: wrap; /* Allow items to wrap on smaller screens */
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo{
      width:40px;
      height:40px;
      border-radius:8px;
      background:linear-gradient(135deg,var(--accent),#ffa94d);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:#082032;
      flex-shrink: 0; /* Prevent logo from shrinking */
    }
    h1{
      font-size:18px; /* Slightly larger for better readability */
      margin:0;
    }
    .subtitle{
      font-size:12px;
      opacity:.8;
      color: var(--secondary-text-color);
    }

    main{
      padding:0 16px 80px;
      flex-grow: 1; /* Allow main content to grow and push footer down */
      max-width: 1200px; /* Max width for larger screens */
      margin: 0 auto; /* Center main content */
      width: 100%; /* Ensure it takes full width within its max-width */
    }

    /* Flash Sale Card (Modified - now just a banner) */
    .flash-card{
      background:linear-gradient(180deg, rgba(255,255,255,0.03), transparent);
      border-radius:12px;
      padding:12px;
      margin-bottom:14px;
      display:flex;
      flex-direction: column; /* Stack on small screens */
      align-items:center;
      gap:12px;
      backdrop-filter:blur(6px);
      text-align: center; /* Center text on small screens */
    }
    .flash-card .left{
      flex:1;
      width: 100%; /* Take full width on small screens */
    }
    /* Removed .countdown and .time-seg styles from here */

    /* Product List */
    .products{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); /* Responsive grid */
      gap:10px;
    }

    .card{
      background:var(--card);
      border-radius:12px;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* Add subtle shadow */
      transition: transform 0.2s ease-in-out; /* Smooth hover effect */
    }
    .card:hover {
      transform: translateY(-3px);
    }
    .img{
      width:100%;
      aspect-ratio:1/1;
      border-radius:8px;
      background:linear-gradient(135deg,#0b2540,#07203a);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#8fb4ff;
      font-weight:700;
      font-size: 1.5em; /* Larger text for initials */
    }
    .title{
      font-size:15px; /* Slightly larger */
      font-weight: 600;
      color: var(--text-color);
    }
    .price{
      font-weight:700;
      font-size:1.1em;
      color: var(--accent); /* Highlight price */
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      flex-wrap: wrap; /* Allow buttons/text to wrap */
    }
    .row > .btn {
      flex-grow: 1; /* Allow buttons to grow */
      min-width: unset; /* Reset min-width from JS for better responsiveness */
    }

    /* New: Countdown styles for individual cards */
    .product-countdown {
      display: flex;
      gap: 4px; /* Smaller gap for compact display */
      align-items: center;
      justify-content: center; /* Center countdown in card */
      font-size: 0.8em; /* Smaller font size */
      margin-top: 4px; /* Space from price */
      color: var(--secondary-text-color);
      font-weight: 600;
    }
    .product-countdown .time-val {
      background: rgba(255,255,255,0.05); /* Slightly lighter background */
      padding: 2px 4px;
      border-radius: 4px;
      min-width: 20px; /* Smaller min-width */
      text-align: center;
      font-weight: 700;
      color: var(--accent); /* Highlight time values */
    }
    .product-countdown .time-label {
      font-size: 0.7em; /* Even smaller label */
      opacity: 0.7;
    }
    .product-countdown.ended {
      color: #ccc;
      font-style: italic;
    }


    .btn{
      display:inline-flex;
      align-items:center;
      justify-content: center; /* Center text in button */
      gap:8px;
      padding:10px 12px; /* Slightly more padding */
      border-radius:10px;
      background:var(--accent);
      color:#082032;
      font-weight:700;
      border:none;
      text-decoration:none;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      white-space: nowrap; /* Prevent text wrapping inside button */
    }
    .btn:hover{
      background: #ff4d4d; /* Darker accent on hover */
    }
    .btn-wa{
      background:linear-gradient(90deg,#25D366,#22c55e);
      color:#042017;
    }
    .btn-wa:hover{
      background:linear-gradient(90deg,#1DAF51,#1AA04A); /* Darker green on hover */
    }

    footer{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      padding:10px 16px;
      background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.8));
      display:flex;
      flex-direction: column; /* Stack on small screens */
      gap:8px;
      align-items:center;
      justify-content:space-between;
      text-align: center; /* Center text on small screens */
      width: 100%;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.3); /* Add shadow to footer */
    }
    .small{
      font-size:12px;
      opacity:.85;
      color: var(--secondary-text-color);
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      width: 400px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    .modal-close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.5em;
      color: var(--text-color);
      cursor: pointer;
      padding: 5px;
      line-height: 1;
    }

    .modal-title {
      font-size: 1.5em;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .modal-price {
      font-size: 1.2em;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--text-color);
    }

    .modal-description {
      font-size: 0.95em;
      line-height: 1.5;
      color: var(--secondary-text-color);
      margin-bottom: 20px;
    }

    /* Media Queries for Responsiveness */

    /* Small devices (phones, 600px and down) */
    @media (max-width: 600px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        padding: 10px 12px;
      }
      /* Removed header .subtitle:last-child { display: none; } */
      h1 {
        font-size: 16px;
      }
      .flash-card {
        padding: 10px;
        gap: 10px;
      }
      .products {
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); /* Adjust for smaller cards */
        gap: 8px;
      }
      .card {
        padding: 8px;
      }
      .title {
        font-size: 13px;
      }
      .price {
        font-size: 1em;
      }
      .row {
        flex-direction: column; /* Stack buttons on very small screens */
        gap: 6px;
      }
      .btn {
        width: 100%; /* Full width buttons */
        padding: 8px 10px;
      }
      footer {
        padding: 8px 12px;
      }
      .small {
        font-size: 11px;
      }
      .modal-content {
        padding: 15px;
      }
      .modal-title {
        font-size: 1.3em;
      }
      .modal-price {
        font-size: 1.1em;
      }
      .product-countdown {
        font-size: 0.7em;
      }
      .product-countdown .time-val {
        padding: 1px 3px;
        min-width: 18px;
      }
    }

    /* Medium devices (tablets, 601px to 768px) */
    @media (min-width: 601px) and (max-width: 768px) {
      header {
        padding: 14px 20px;
      }
      main {
        padding: 0 20px 80px;
      }
      .flash-card {
        flex-direction: row; /* Keep side-by-side */
        text-align: left;
        padding: 15px;
      }
      .products {
        grid-template-columns: repeat(3, 1fr); /* 3 columns for tablets */
      }
      footer {
        flex-direction: row; /* Keep side-by-side */
        padding: 10px 20px;
      }
    }

    /* Large devices (desktops, 769px and up) */
    @media (min-width: 769px) {
      header {
        padding: 14px 40px;
      }
      main {
        padding: 0 40px 80px;
      }
      .flash-card {
        flex-direction: row; /* Keep side-by-side */
        text-align: left;
        padding: 15px 20px;
      }
      .products {
        grid-template-columns: repeat(4, 1fr); /* 4 columns for desktops */
        gap: 15px;
      }
      .card {
        padding: 12px;
      }
      .title {
        font-size: 16px;
      }
      .price {
        font-size: 1.2em;
      }
      .btn {
        padding: 10px 15px;
      }
      footer {
        flex-direction: row; /* Keep side-by-side */
        padding: 10px 40px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">DS</div>
      <div>
        <h1>Deepa Store</h1>
        <div class="subtitle">Flash Sale — Pilihan Terbaik untuk HP</div>
      </div>
    </div>
    <!-- Removed the "Mobile friendly" subtitle div -->
  </header>

  <main>
    <!-- FLASH SALE CARD (Simplified - no global countdown) -->
    <section class="flash-card" aria-live="polite">
      <div class="left">
        <div style="font-weight:800">Flash Sale Berlangsung!</div>
        <div style="font-size:13px;opacity:.85">Diskon besar — hanya sampai waktu habis</div>
      </div>
      <!-- Removed global countdown div -->
    </section>

    <!-- PRODUCT LIST -->
    <section class="products" id="product-list">
      <!-- product template inserted by JS -->
    </section>
  </main>

  <footer>
    <div class="small">Pilih produk lalu tekan "Order" untuk pesan via WhatsApp.</div>
    <div class="small">Ganti nomor WA dan waktu flash sale di script jika perlu.</div>
  </footer>

  <!-- Product Detail Modal -->
  <div class="modal-overlay" id="product-detail-modal">
    <div class="modal-content">
      <button class="modal-close-btn" id="modal-close-btn">&times;</button>
      <h3 class="modal-title" id="modal-product-name"></h3>
      <p class="modal-price" id="modal-product-price"></p>
      <p class="modal-description" id="modal-product-description"></p>
      <a class="btn btn-wa" id="modal-order-btn" href="#" target="_blank" rel="noopener noreferrer">Order via WhatsApp</a>
    </div>
  </div>

<script>
// ----- CONFIG: ubah nomor WA dan waktu akhir di sini -----
const SELLER_WHATSAPP = '+6281234567890'; // contoh: +6281234567890 (ganti dengan nomor Anda tanpa spasi)
// Set waktu akhir flash sale (format: YYYY-MM-DDTHH:MM:SS) - sesuaikan timezone
const SALE_END_ISO = '2025-08-15T23:59:59'; // This will be the end time for ALL products
// -------------------------------------------------------

// Sample catalog (ganti/muat dari server sesuai kebutuhan)
const CATALOG = [
  {id:1,name:'Earphone Bluetooth X1',price:'Rp99.000',desc:'Suara jernih, baterai 8 jam'},
  {id:2,name:'Powerbank Slim 10.000mAh',price:'Rp149.000',desc:'Isi cepat, ringan'},
  {id:3,name:'Case HP Anti-Shock',price:'Rp79.000',desc:'Proteksi maksimal, tipis'},
  {id:4,name:'Charger Fast 30W',price:'Rp129.000',desc:'Pengisian aman'},
  {id:5,name:'Kabel USB-C 1.5m',price:'Rp39.000',desc:'Kuat dan fleksibel'},
  {id:6,name:'Holder Mobil Magnet',price:'Rp59.000',desc:'Magnet kuat, pemasangan mudah'},
  // additional product to test special characters/encoding
  {id:7,name:'Speaker "Mini" 5W (Bass+)',price:'Rp199.000',desc:'Suara mantap — cocok di meja kerja'}
];

// render products
const productList = document.getElementById('product-list');
function renderCatalog(){
  productList.innerHTML = '';
  CATALOG.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <div class="img">${(p.name||'').split(' ').slice(0,2).map(s=>s[0]||'').join('')}</div>
      <div class="title">${escapeHtml(p.name)}</div>
      <div class="row">
        <div class="price">${escapeHtml(p.price)}</div>
      </div>
      <div class="product-countdown" id="countdown-${p.id}">
        <!-- Countdown will be updated by JS -->
        <span class="time-val" id="days-${p.id}">00</span><span class="time-label">h</span>
        <span class="time-val" id="hours-${p.id}">00</span><span class="time-label">j</span>
        <span class="time-val" id="mins-${p.id}">00</span><span class="time-label">m</span>
        <span class="time-val" id="secs-${p.id}">00</span><span class="time-label">d</span>
      </div>
      <div class="row">
        <a class="btn" href="#" onclick="openDetail(${p.id});return false;" aria-label="Detail ${escapeHtml(p.name)}">Detail</a>
        <a class="btn btn-wa" href="${waLink(p)}" target="_blank" rel="noopener noreferrer" aria-label="Order ${escapeHtml(p.name)} via WhatsApp">Order</a>
      </div>
    `;
    productList.appendChild(card);
  });
  // After rendering, initialize all countdowns
  initializeAllCountdowns();
}

// waLink now accepts either a product object OR a product id (robust)
function waLink(productOrId){
  let item = null;
  if(productOrId && typeof productOrId === 'object' && productOrId.id !== undefined){
    item = productOrId;
  } else {
    item = CATALOG.find(c=>c.id === productOrId);
  }
  if(!item){
    console.error('waLink: product not found', productOrId);
    // return a safe noop link to avoid runtime errors in href
    return '#';
  }
  // Build message
  const message = `Halo, saya mau pesan *${item.name}* (ID:${item.id}) — apakah masih ada?\nHarga: ${item.price}`;
  const text = encodeURIComponent(message);
  // wa.me link format: https://wa.me/<number>?text=<encoded text>
  const number = (SELLER_WHATSAPP || '').replace(/[^\d+]/g,'');
  const clean = number.startsWith('+') ? number.slice(1) : number;
  if(!clean){
    console.error('waLink: invalid SELLER_WHATSAPP', SELLER_WHATSAPP);
    return '#';
  }
  return `https://wa.me/${clean}?text=${text}`;
}

// Modal Elements
const productDetailModal = document.getElementById('product-detail-modal');
const modalCloseBtn = document.getElementById('modal-close-btn');
const modalProductName = document.getElementById('modal-product-name');
const modalProductPrice = document.getElementById('modal-product-price');
const modalProductDescription = document.getElementById('modal-product-description');
const modalOrderBtn = document.getElementById('modal-order-btn');

function openDetail(id){
  const item = CATALOG.find(c=>c.id===id);
  if(!item){
    alert('Produk tidak ditemukan.');
    return;
  }

  // Populate modal content
  modalProductName.textContent = escapeHtml(item.name);
  modalProductPrice.textContent = escapeHtml(item.price);
  modalProductDescription.textContent = escapeHtml(item.desc);
  modalOrderBtn.href = waLink(item); // Set WhatsApp link for the modal button

  // Show the modal
  productDetailModal.classList.add('active');
  document.body.style.overflow = 'hidden'; // Prevent scrolling background
}

function closeDetailModal(){
  productDetailModal.classList.remove('active');
  document.body.style.overflow = ''; // Restore scrolling
}

// Close modal when close button is clicked
modalCloseBtn.addEventListener('click', closeDetailModal);

// Close modal when clicking outside the content
productDetailModal.addEventListener('click', (e) => {
  if (e.target === productDetailModal) {
    closeDetailModal();
  }
});

// simple helper to avoid HTML injection in inserted strings
function escapeHtml(str){
  if(!str) return '';
  return String(str).replace(/[&<>\"']/g, function(s) {
    return ({
      '&':'&amp;',
      '<':'&lt;',
      '>':'&gt;',
      '"':'&quot;',
      "'":'&#39;'
    })[s];
  });
}

// --- Multiple Countdowns Logic ---
const endTime = new Date(SALE_END_ISO).getTime();
let countdownElements = {}; // Store references to all countdown elements

function initializeAllCountdowns() {
  CATALOG.forEach(p => {
    countdownElements[p.id] = {
      container: document.getElementById(`countdown-${p.id}`),
      days: document.getElementById(`days-${p.id}`),
      hours: document.getElementById(`hours-${p.id}`),
      mins: document.getElementById(`mins-${p.id}`),
      secs: document.getElementById(`secs-${p.id}`)
    };
    // Initial update for each countdown
    updateProductCountdown(p.id);
  });
}

function updateProductCountdown(productId) {
  const now = Date.now();
  let diff = endTime - now;
  const els = countdownElements[productId];

  if (!els || !els.container) return; // Element might not exist yet or was removed

  if (diff <= 0) {
    els.days.textContent = '00';
    els.hours.textContent = '00';
    els.mins.textContent = '00';
    els.secs.textContent = '00';
    els.container.innerHTML = 'Sale Ended!'; // Or any other message
    els.container.classList.add('ended');
    return;
  }

  const d = Math.floor(diff / (1000 * 60 * 60 * 24));
  diff -= d * (1000 * 60 * 60 * 24);
  const h = Math.floor(diff / (1000 * 60 * 60));
  diff -= h * (1000 * 60 * 60);
  const m = Math.floor(diff / (1000 * 60));
  diff -= m * (1000 * 60);
  const s = Math.floor(diff / 1000);

  els.days.textContent = String(d).padStart(2, '0');
  els.hours.textContent = String(h).padStart(2, '0');
  els.mins.textContent = String(m).padStart(2, '0');
  els.secs.textContent = String(s).padStart(2, '0');
}

// Call renderCatalog to display products and initialize their countdowns
renderCatalog();

// Set up a single interval to update all countdowns
const globalTimerInterval = setInterval(() => {
  CATALOG.forEach(p => {
    updateProductCountdown(p.id);
  });
}, 1000);

// Optional: Clear interval if all sales have ended (more complex for individual sales)
// For a single global end time, you can check if endTime is reached.
// If (endTime - Date.now() <= 0) { clearInterval(globalTimerInterval); }
</script>
</body>
</html>

