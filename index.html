<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deepa Store - Mobile Flash Sale</title>
  <style>
    :root{
      --accent:#ff6b6b;
      --bg:#0f1724;
      --card:#0b1220;
      --glass:rgba(255,255,255,0.04);
      --text-color:#e6eef8; /* Define a text color variable */
      --secondary-text-color:rgba(230, 239, 248, 0.8); /* Define a secondary text color variable */
    }
    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    html,body{
      height:100%;
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background:linear-gradient(180deg,#071028 0%, #071835 100%);
      color:var(--text-color);
      -webkit-font-smoothing:antialiased;
      line-height:1.6; /* Improve readability */
      /* Removed overflow: hidden; from body */
    }

    /* Removed #site-wrapper styles */
    /* Removed #intro-overlay styles */
    /* Removed #intro-overlay h2 styles */
    /* Removed #open-website-btn styles */


    header{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      flex-wrap: wrap; /* Allow items to wrap on smaller screens */
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo{
      width:40px;
      height:40px;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink: 0; /* Prevent logo from shrinking */
      overflow: hidden;
    }
    
    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
      transition: transform 0.3s ease;
    }
    .logo:hover img {
      transform: scale(1.1);
    }
    h1{
      font-size:18px; /* Slightly larger for better readability */
      margin:0;
    }
    .subtitle{
      font-size:12px;
      opacity:.8;
      color: var(--secondary-text-color);
    }

    /* Search Input Styles */
    .search-container {
      flex-grow: 1; /* Allow search bar to take available space */
      max-width: 300px; /* Limit max width */
      margin-left: 20px; /* Space from brand */
    }
    .search-input {
      width: 100%;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.05);
      color: var(--text-color);
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s ease, background 0.2s ease;
    }
    .search-input::placeholder {
      color: var(--secondary-text-color);
      opacity: 0.7;
    }
    .search-input:focus {
      border-color: var(--accent);
      background: rgba(255,255,255,0.1);
    }


    main{
      padding:0 16px 80px;
      flex-grow: 1; /* Allow main content to grow and push footer down */
      max-width: 1200px; /* Max width for larger screens */
      margin: 0 auto; /* Center main content */
      width: 100%; /* Ensure it takes full width within its max-width */
    }

    /* Flash Sale Card (Modified - now just a banner) */
    .flash-card{
      background:linear-gradient(180deg, rgba(255,255,255,0.03), transparent);
      border-radius:12px;
      padding:12px;
      margin-bottom:14px;
      display:flex;
      flex-direction: column; /* Stack on small screens */
      align-items:center;
      gap:12px;
      backdrop-filter:blur(6px);
      text-align: center; /* Center text on small screens */
    }
    .flash-card .left{
      flex:1;
      width: 100%; /* Take full width on small screens */
    }
    /* Removed .countdown and .time-seg styles from here */

    /* Product List */
    .products{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); /* Responsive grid */
      gap:10px;
    }

    .card{
      background:var(--card);
      border-radius:12px;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* Add subtle shadow */
      transition: transform 0.2s ease-in-out; /* Smooth hover effect */
    }
    .card:hover {
      transform: translateY(-3px);
    }
    /* Modified .img to hold actual image */
    .img{
      width:100%;
      aspect-ratio:1/1;
      border-radius:8px;
      background:linear-gradient(135deg,#0b2540,#07203a); /* Fallback background */
      display:flex;
      align-items:center;
      justify-content:center;
      color:#8fb4ff;
      font-weight:700;
      font-size: 1.5em; /* Larger text for initials */
      overflow: hidden; /* Ensure image doesn't overflow rounded corners */
    }
    .img img {
      width: 100%;
      height: 100%;
      object-fit: cover; /* Cover the area, cropping if necessary */
      display: block; /* Remove extra space below image */
      border-radius: 8px; /* Apply border-radius to image itself */
    }

    .title{
      font-size:15px; /* Slightly larger */
      font-weight: 700;
      color: var(--text-color);
    }
    .price{
      font-weight:400;
      font-size:1.1em;
      color: var(--accent); /* Highlight price */
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      flex-wrap: wrap; /* Allow buttons/text to wrap */
    }
    .row > .btn {
      flex-grow: 1; /* Allow buttons to grow */
      min-width: unset; /* Reset min-width from JS for better responsiveness */
    }

    /* New: Countdown styles for individual cards */
    .product-countdown {
      display: flex;
      gap: 4px; /* Smaller gap for compact display */
      align-items: center;
      justify-content: center; /* Center countdown in card */
      font-size: 0.8em; /* Smaller font size */
      margin-top: 4px; /* Space from price */
      color: var(--secondary-text-color);
      font-weight: 600;
    }
    .product-countdown .time-val {
      background: rgba(255,255,255,0.05); /* Slightly lighter background */
      padding: 2px 4px;
      border-radius: 4px;
      min-width: 20px; /* Smaller min-width */
      text-align: center;
      font-weight: 700;
      color: var(--accent); /* Highlight time values */
    }
    .product-countdown .time-label {
      font-size: 0.7em; /* Even smaller label */
      opacity: 0.7;
    }
    .product-countdown.ended {
      color: #ccc;
      font-style: italic;
    }

    /* New: Stock display styles */
    .product-stock {
      font-size: 0.8em; /* Reduced from 0.9em */
      color: var(--secondary-text-color);
      margin-top: 4px;
      text-align: center;
      font-weight: 500;
    }
    .product-stock.low-stock {
      color: var(--accent); /* Highlight low stock */
      font-weight: 700;
    }
    .product-stock.out-of-stock {
      color: #ff0000; /* Red for out of stock */
      font-weight: 700;
    }


    .btn{
      display:inline-flex;
      align-items:center;
      justify-content: center; /* Center text in button */
      gap:8px;
      padding:10px 12px; /* Slightly more padding */
      border-radius:10px;
      background:var(--accent);
      color:#082032;
      font-weight:700;
      border:none;
      text-decoration:none;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      white-space: nowrap; /* Prevent text wrapping inside button */
    }
    .btn:hover{
      background: #ff4d4d;
    }
    .btn-wa{
      background:linear-gradient(90deg,#25D366,#22c55e);
      color:#042017;
    }
    .btn-wa:hover{
      background:linear-gradient(90deg,#1DAF51,#1AA04A);
    }

    footer{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      padding:10px 16px;
      background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.8));
      display:flex;
      flex-direction: column; /* Stack on small screens */
      gap:8px;
      align-items:center;
      justify-content:space-between;
      text-align: center; /* Center text on small screens */
      width: 100%;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.3); /* Add shadow to footer */
    }
    .small{
      font-size:12px;
      opacity:.85;
      color: var(--secondary-text-color);
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      width: 400px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    .modal-close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.5em;
      color: var(--text-color);
      cursor: pointer;
      padding: 5px;
      line-height: 1;
    }

    .modal-title {
      font-size: 1.5em;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .modal-price {
      font-size: 1.2em;
      font-weight: 400;
      margin-bottom: 15px;
      color: var(--text-color);
    }

    .modal-description {
      font-size: 0.95em;
      line-height: 1.5;
      color: var(--secondary-text-color);
      margin-bottom: 20px;
    }
    .modal-stock {
      font-size: 0.9em;
      color: var(--secondary-text-color);
      margin-bottom: 15px;
      font-weight: 600;
    }
    .modal-stock.low-stock {
      color: var(--accent);
    }
    .modal-stock.out-of-stock {
      color: #ff0000;
    }


    /* Media Queries for Responsiveness */

    /* Small devices (phones, 600px and down) */
    @media (max-width: 600px) {
      /* Removed #intro-overlay h2 styles */
      /* Removed #open-website-btn styles */

      header {
        flex-direction: column;
        align-items: flex-start;
        padding: 10px 12px;
      }
      .search-container {
        margin-left: 0; /* Remove left margin on small screens */
        width: 100%; /* Full width on small screens */
        max-width: none; /* Remove max width constraint */
        order: 3; /* Place it below brand and subtitle */
      }
      h1 {
        font-size: 16px;
      }
      .flash-card {
        padding: 10px;
        gap: 10px;
      }
      .products {
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 8px;
      }
      .card {
        padding: 8px;
      }
      .title {
        font-size: 13px;
      }
      .price {
        font-size: 1em;
      }
      .row {
        flex-direction: column;
        gap: 6px;
      }
      .btn {
        width: 100%;
        padding: 8px 10px;
      }
      footer {
        padding: 8px 12px;
      }
      .small {
        font-size: 11px;
      }
      .modal-content {
        padding: 15px;
      }
      .modal-title {
        font-size: 1.3em;
      }
      .modal-price {
        font-size: 1.1em;
      }
      .product-countdown {
        font-size: 0.7em;
      }
      .product-countdown .time-val {
        padding: 1px 3px;
        min-width: 18px;
      }
      .product-stock {
        font-size: 0.7em;
      }
      .modal-stock {
        font-size: 0.8em;
      }
    }

    /* Medium devices (tablets, 601px to 768px) */
    @media (min-width: 601px) and (max-width: 768px) {
      header {
        padding: 14px 20px;
      }
      main {
        padding: 0 20px 80px;
      }
      .flash-card {
        flex-direction: row;
        text-align: left;
        padding: 15px;
      }
      .products {
        grid-template-columns: repeat(3, 1fr);
      }
      footer {
        flex-direction: row;
        padding: 10px 20px;
      }
    }

    /* Large devices (desktops, 769px and up) */
    @media (min-width: 769px) {
      header {
        padding: 14px 40px;
      }
      main {
        padding: 0 40px 80px;
      }
      .flash-card {
        flex-direction: row;
        text-align: left;
        padding: 15px 20px;
      }
      .products {
        grid-template-columns: repeat(4, 1fr);
      }
      footer {
        flex-direction: row;
        padding: 10px 40px;
      }
    }
  </style>
</head>
<body>

  <!-- Removed Intro Overlay -->
  <!-- Removed Audio Element -->

  <!-- Site Content (No longer wrapped in #site-wrapper) -->
  <header>
    <div class="brand">
      <div class="logo">
        <img src="onep.gif" alt="Deepa Store Logo">
      </div>
      <div>
        <h1>Deepa Store</h1>
        <div class="subtitle">Flash Sale — Pilihan Terbaik untuk HP</div>
      </div>
    </div>
    <!-- Search Input Added Here -->
    <div class="search-container">
      <input type="text" id="search-input" class="search-input" placeholder="Cari produk...">
    </div>
  </header>

  <main>
    <!-- FLASH SALE CARD (Simplified - no global countdown) -->
    <section class="flash-card" aria-live="polite">
      <div class="left">
        <div style="font-weight:800">Flash Sale Berlangsung!</div>
        <div style="font-size:13px;opacity:.85">Diskon besar — hanya sampai waktu habis</div>
      </div>
    </section>

    <!-- PRODUCT LIST -->
    <section class="products" id="product-list">
      <!-- product template inserted by JS -->
    </section>
  </main>

  <footer>
    <div class="small">Pilih produk lalu tekan "Order" untuk pesan via WhatsApp.</div>
    <div class="small">Ganti nomor WA dan waktu flash sale di script jika perlu.</div>
  </footer>

  <!-- Product Detail Modal -->
  <div class="modal-overlay" id="product-detail-modal">
    <div class="modal-content">
      <button class="modal-close-btn" id="modal-close-btn">&times;</button>
      <h3 class="modal-title" id="modal-product-name"></h3>
      <p class="modal-price" id="modal-product-price"></p>
      <p class="modal-stock" id="modal-product-stock"></p>
      <p class="modal-description" id="modal-product-description"></p>
      <a class="btn btn-wa" id="modal-order-btn" href="#" target="_blank" rel="noopener noreferrer">Order via WhatsApp</a>
    </div>
  </div>

<script>
// ----- CONFIG: ubah nomor WA dan waktu akhir di sini -----
const SELLER_WHATSAPP = '+6281234567890'; // contoh: +6281234567890 (ganti dengan nomor Anda tanpa spasi)
// Set waktu akhir flash sale (format: YYYY-MM-DDTHH:MM:SS) - sesuaikan timezone
const SALE_END_ISO = '2025-08-15T23:59:59'; // This will be the end time for ALL products
// -------------------------------------------------------

// Sample catalog (ganti/muat dari server sesuai kebutuhan)
const CATALOG = [
  {id:1,name:'WhatsApp',price:'Rp6.000',desc:'Non Garansi, garansi 3 hari verif/otp ulang', stock: 15, image: 'whatsapp.png'},
  {id:2,name:'Gojek',price:'Rp3.000',desc:'Sudah termasuk setting pin Gojek & Gopay', stock: 5, image: 'gojek.jpg'},
  {id:3,name:'KopKen',price:'Rp2.000',desc:'Tidak ada garansi', stock: 2, image: 'kopken.png'}, // Low stock example
  {id:4,name:'Lazada',price:'Rp2.000',desc:'Tidak ada garansi', stock: 0, image: 'lazada.png'}, // Out of stock example
  {id:5,name:'BliBli',price:'Rp2.000',desc:'Tidak ada garansi', stock: 20, image: 'blibli.png'},
  {id:6,name:'Gmail',price:'Rp2.000',desc:'Tidak ada garansi', stock: 8, image: 'gmail.png'},
  {id:6,name:'Fore',price:'Rp2.000',desc:'Tidak ada garansi', stock: 8, image: 'fore.png'},
  {id:6,name:'Qpon',price:'Rp2.000',desc:'Garansi verif/OTP ulang 3 hari', stock: 8, image: 'qpon.jpg'}
  // additional product to test special characters/encoding
  {id:7,name:'Speaker "Mini" 5W (Bass+)',price:'Rp199.000',desc:'Suara mantap — cocok di meja kerja', stock: 10, image: 'https://via.placeholder.com/150/FFA94D/FFFFFF?text=Speaker'}
];

// render products
const productList = document.getElementById('product-list');
const searchInput = document.getElementById('search-input'); // Get the search input element

function renderCatalog(searchTerm = ''){
  productList.innerHTML = '';
  const lowerCaseSearchTerm = searchTerm.toLowerCase();
  const filteredCatalog = CATALOG.filter(p => {
    return p.name.toLowerCase().includes(lowerCaseSearchTerm) ||
           p.desc.toLowerCase().includes(lowerCaseSearchTerm);
  });

  if (filteredCatalog.length === 0 && searchTerm !== '') {
    productList.innerHTML = '<p style="text-align: center; width: 100%; margin-top: 20px; color: var(--secondary-text-color);">Produk tidak ditemukan.</p>';
    return;
  }

  filteredCatalog.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'card';

    // Determine stock class
    let stockClass = '';
    let stockText = '';
    if (p.stock === 0) {
      stockClass = 'out-of-stock';
      stockText = 'Stok Habis';
    } else if (p.stock <= 5) { // Example threshold for low stock
      stockClass = 'low-stock';
      stockText = `Stok: ${p.stock} (Terbatas!)`;
    } else {
      stockText = `Stok: ${p.stock}`;
    }

    card.innerHTML = `
      <div class="img">
        <img src="${escapeHtml(p.image)}" alt="${escapeHtml(p.name)}" loading="lazy">
      </div>
      <div class="title">${escapeHtml(p.name)}</div>
      <div class="row">
        <div class="price">${escapeHtml(p.price)}</div>
      </div>
      <div class="product-stock ${stockClass}">${escapeHtml(stockText)}</div>
      <div class="product-countdown" id="countdown-${p.id}">
        <span class="time-val" id="days-${p.id}">00</span><span class="time-label">h</span>
        <span class="time-val" id="hours-${p.id}">00</span><span class="time-label">j</span>
        <span class="time-val" id="mins-${p.id}">00</span><span class="time-label">m</span>
        <span class="time-val" id="secs-${p.id}">00</span><span class="time-label">d</span>
      </div>
      <div class="row">
        <a class="btn" href="#" onclick="openDetail(${p.id});return false;" aria-label="Detail ${escapeHtml(p.name)}">Detail</a>
        <a class="btn btn-wa" href="${waLink(p)}" target="_blank" rel="noopener noreferrer" aria-label="Order ${escapeHtml(p.name)} via WhatsApp">Order</a>
      </div>
    `;
    productList.appendChild(card);
  });
  initializeAllCountdowns(); // Re-initialize countdowns for filtered products
}

// waLink now accepts either a product object OR a product id (robust)
function waLink(productOrId){
  let item = null;
  if(productOrId && typeof productOrId === 'object' && productOrId.id !== undefined){
    item = productOrId;
  } else {
    item = CATALOG.find(c=>c.id === productOrId);
  }
  if(!item){
    console.error('waLink: product not found', productOrId);
    return '#';
  }
  const message = `Halo, saya mau pesan *${item.name}* (ID:${item.id}) — apakah masih ada?\nHarga: ${item.price}`;
  const text = encodeURIComponent(message);
  const number = (SELLER_WHATSAPP || '').replace(/[^\d+]/g,'');
  const clean = number.startsWith('+') ? number.slice(1) : number;
  if(!clean){
    console.error('waLink: invalid SELLER_WHATSAPP', SELLER_WHATSAPP);
    return '#';
  }
  return `https://wa.me/${clean}?text=${text}`;
}

// Modal Elements
const productDetailModal = document.getElementById('product-detail-modal');
const modalCloseBtn = document.getElementById('modal-close-btn');
const modalProductName = document.getElementById('modal-product-name');
const modalProductPrice = document.getElementById('modal-product-price');
const modalProductStock = document.getElementById('modal-product-stock');
const modalProductDescription = document.getElementById('modal-product-description');
const modalOrderBtn = document.getElementById('modal-order-btn');

function openDetail(id){
  const item = CATALOG.find(c=>c.id===id);
  if(!item){
    alert('Produk tidak ditemukan.');
    return;
  }

  let modalStockText = '';
  let modalStockClass = '';
  if (item.stock === 0) {
    modalStockText = 'Stok: Habis';
    modalStockClass = 'out-of-stock';
  } else if (item.stock <= 5) {
    modalStockText = `Stok: ${item.stock} (Terbatas!)`;
    modalStockClass = 'low-stock';
  } else {
    modalStockText = `Stok: ${item.stock}`;
  }

  modalProductName.textContent = escapeHtml(item.name);
  modalProductPrice.textContent = escapeHtml(item.price);
  modalProductStock.textContent = escapeHtml(modalStockText);
  modalProductStock.className = `modal-stock ${modalStockClass}`;
  modalProductDescription.textContent = escapeHtml(item.desc);
  modalOrderBtn.href = waLink(item);

  productDetailModal.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeDetailModal(){
  productDetailModal.classList.remove('active');
  document.body.style.overflow = '';
}

modalCloseBtn.addEventListener('click', closeDetailModal);
productDetailModal.addEventListener('click', (e) => {
  if (e.target === productDetailModal) {
    closeDetailModal();
  }
});

function escapeHtml(str){
  if(!str) return '';
  return String(str).replace(/[&<>\"']/g, function(s) {
    return ({
      '&':'&amp;',
      '<':'&lt;',
      '>':'&gt;',
      '"':'&quot;',
      "'":'&#39;'
    })[s];
  });
}

// --- Multiple Countdowns Logic ---
const endTime = new Date(SALE_END_ISO).getTime();
let countdownElements = {}; // This will store references to countdown elements for currently displayed products

function initializeAllCountdowns() {
  // Clear previous countdown elements to avoid memory leaks and incorrect updates
  countdownElements = {};
  // Iterate over the original CATALOG to find elements, as filtered products might not always be present
  CATALOG.forEach(p => {
    const container = document.getElementById(`countdown-${p.id}`);
    if (container) { // Only initialize if the element exists (i.e., product is currently displayed)
      countdownElements[p.id] = {
        container: container,
        days: document.getElementById(`days-${p.id}`),
        hours: document.getElementById(`hours-${p.id}`),
        mins: document.getElementById(`mins-${p.id}`),
        secs: document.getElementById(`secs-${p.id}`)
      };
      updateProductCountdown(p.id); // Initial update for this product
    }
  });
}

function updateProductCountdown(productId) {
  const now = Date.now();
  let diff = endTime - now;
  const els = countdownElements[productId];

  if (!els || !els.container) return; // Product might have been filtered out or not yet rendered

  if (diff <= 0) {
    els.container.innerHTML = 'Sale Ended!';
    els.container.classList.add('ended');
    return;
  }

  const d = Math.floor(diff / (1000 * 60 * 60 * 24));
  diff -= d * (1000 * 60 * 60 * 24);
  const h = Math.floor(diff / (1000 * 60 * 60));
  diff -= h * (1000 * 60 * 60);
  const m = Math.floor(diff / (1000 * 60));
  diff -= m * (1000 * 60);
  const s = Math.floor(diff / 1000);

  els.days.textContent = String(d).padStart(2, '0');
  els.hours.textContent = String(h).padStart(2, '0');
  els.mins.textContent = String(m).padStart(2, '0');
  els.secs.textContent = String(s).padStart(2, '0');
}

// Update all visible countdowns every second
setInterval(() => {
  // Iterate over the keys of countdownElements to only update currently displayed products
  Object.keys(countdownElements).forEach(productId => {
    updateProductCountdown(parseInt(productId));
  });
}, 1000);


// --- Initialization for direct display ---
// Call renderCatalog directly when the script loads
renderCatalog();

// Add event listener for search input
searchInput.addEventListener('keyup', (event) => {
  renderCatalog(event.target.value);
});

// Removed all intro overlay and music related JavaScript
// Removed openWebsiteBtn, backgroundMusic, siteWrapper variables
// Removed openWebsiteBtn.addEventListener
// Removed DOMContentLoaded listener
</script>
</body>
</html>
